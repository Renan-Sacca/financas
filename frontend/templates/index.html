<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Finanças Pessoais</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">Finanças Pessoais</a>
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="#" onclick="showSection('dashboard')">Dashboard</a>
                <a class="nav-link" href="#" onclick="showSection('banks')">Bancos</a>
                <a class="nav-link" href="#" onclick="showSection('cards')">Cartões</a>
                <a class="nav-link" href="#" onclick="showSection('categories')">Categorias</a>
                <a class="nav-link" href="#" onclick="showSection('transactions')">Transações</a>
                <a class="nav-link" href="#" onclick="showSection('transfers')">Depósitos</a>
            </div>
            <div class="navbar-nav">
                <span class="navbar-text me-3" id="user-info">Carregando...</span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">Sair</button>
            </div>
        </div>
    </nav>
    
    <div class="container mt-4">
        
        <!-- Dashboard -->
        <div id="dashboard-section" class="section">
            <h2>Dashboard</h2>
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Resumo Financeiro</h5>
                        </div>
                        <div class="card-body" id="summary-section">
                            <!-- Conteúdo carregado via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Gastos Mensais</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3 dashboard-filters">
                                <div class="col-md-2">
                                    <label for="dash-filter-bank" class="form-label">Banco</label>
                                    <select class="form-select" id="dash-filter-bank">
                                        <option value="">Todos os bancos</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label for="dash-filter-card" class="form-label">Cartão</label>
                                    <select class="form-select" id="dash-filter-card">
                                        <option value="">Todos os cartões</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label for="dash-filter-year" class="form-label">Ano</label>
                                    <select class="form-select" id="dash-filter-year">
                                        <option value="">Todos os anos</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label for="dash-filter-month" class="form-label">Mês</label>
                                    <select class="form-select" id="dash-filter-month">
                                        <option value="">Todos os meses</option>
                                        <option value="1">Janeiro</option>
                                        <option value="2">Fevereiro</option>
                                        <option value="3">Março</option>
                                        <option value="4">Abril</option>
                                        <option value="5">Maio</option>
                                        <option value="6">Junho</option>
                                        <option value="7">Julho</option>
                                        <option value="8">Agosto</option>
                                        <option value="9">Setembro</option>
                                        <option value="10">Outubro</option>
                                        <option value="11">Novembro</option>
                                        <option value="12">Dezembro</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label for="dash-filter-category" class="form-label">Categoria</label>
                                    <select class="form-select" id="dash-filter-category">
                                        <option value="">Todas as categorias</option>
                                    </select>
                                </div>
                                <div class="col-md-2 d-flex align-items-end gap-2">
                                    <button class="btn btn-primary" onclick="applyDashboardFilters()">Aplicar</button>
                                    <button class="btn btn-outline-secondary" onclick="clearDashboardFilters()">Limpar</button>
                                </div>
                                <div class="col-md-2 d-flex align-items-end justify-content-end">
                                    <div class="text-end">
                                        <small class="text-muted">Total do período:</small>
                                        <div class="h5 text-primary" id="period-total">R$ 0,00</div>
                                    </div>
                                </div>
                            </div>
                            <div style="height: 400px;">
                                <canvas id="expenseChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Limite de Crédito</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="credit-filter-bank" class="form-label">Banco</label>
                                    <select class="form-select" id="credit-filter-bank">
                                        <option value="">Todos os bancos</option>
                                    </select>
                                </div>
                                <div class="col-md-6 d-flex align-items-end gap-2">
                                    <button class="btn btn-primary btn-sm" onclick="applyCreditFilters()">Aplicar</button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearCreditFilters()">Limpar</button>
                                </div>
                            </div>
                            <div style="height: 400px;">
                                <canvas id="creditChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Gastos por Cartão</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="pie-filter-bank" class="form-label">Banco</label>
                                    <select class="form-select" id="pie-filter-bank">
                                        <option value="">Todos os bancos</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="pie-filter-date-from" class="form-label">Data Inicial</label>
                                    <input type="date" class="form-control" id="pie-filter-date-from">
                                </div>
                                <div class="col-md-6">
                                    <label for="pie-filter-date-to" class="form-label">Data Final</label>
                                    <input type="date" class="form-control" id="pie-filter-date-to">
                                </div>
                                <div class="col-md-6 d-flex align-items-end gap-2">
                                    <button class="btn btn-primary btn-sm" onclick="applyPieFilters()">Aplicar</button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearPieFilters()">Limpar</button>
                                </div>
                            </div>
                            <div style="height: 400px;">
                                <canvas id="cardPieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Gastos por Categoria</h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-2">
                                    <label for="category-pie-filter-bank" class="form-label">Banco</label>
                                    <select class="form-select" id="category-pie-filter-bank">
                                        <option value="">Todos os bancos</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label for="category-pie-filter-date-from" class="form-label">Data Inicial</label>
                                    <input type="date" class="form-control" id="category-pie-filter-date-from">
                                </div>
                                <div class="col-md-2">
                                    <label for="category-pie-filter-date-to" class="form-label">Data Final</label>
                                    <input type="date" class="form-control" id="category-pie-filter-date-to">
                                </div>
                                <div class="col-md-2 d-flex align-items-end gap-2">
                                    <button class="btn btn-primary btn-sm" onclick="applyCategoryPieFilters()">Aplicar</button>
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearCategoryPieFilters()">Limpar</button>
                                </div>
                            </div>
                            <div style="height: 400px;">
                                <canvas id="categoryPieChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bancos -->
        <div id="banks-section" class="section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Bancos</h2>
                <button class="btn btn-primary" onclick="showBankForm()">Novo Banco</button>
            </div>
            
            <div id="bank-form-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 id="bank-form-title">Adicionar Banco</h5>
                    </div>
                    <div class="card-body">
                        <form id="bank-form">
                            <input type="hidden" id="bank-id">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="bank-name" class="form-label">Nome do Banco</label>
                                        <input type="text" class="form-control" id="bank-name" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="initial-balance" class="form-label">Saldo Atual</label>
                                        <input type="number" step="0.01" class="form-control" id="initial-balance" value="0">
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success me-2">Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideBankForm()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div id="banks-list">
                        <!-- Conteúdo carregado via JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Categorias -->
        <div id="categories-section" class="section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Categorias</h2>
                <button class="btn btn-primary" onclick="showCategoryForm()">Nova Categoria</button>
            </div>
            
            <div id="category-form-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Adicionar Categoria</h5>
                    </div>
                    <div class="card-body">
                        <form id="category-form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="category-name" class="form-label">Nome da Categoria</label>
                                        <input type="text" class="form-control" id="category-name" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="category-color" class="form-label">Cor</label>
                                        <input type="color" class="form-control" id="category-color" value="#007bff">
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success me-2">Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideCategoryForm()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div id="categories-list">
                        <!-- Conteúdo carregado via JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cartões -->
        <div id="cards-section" class="section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Cartões</h2>
                <button class="btn btn-primary" onclick="showCardForm()">Novo Cartão</button>
            </div>
            
            <div id="card-form-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 id="card-form-title">Adicionar Cartão</h5>
                    </div>
                    <div class="card-body">
                        <form id="card-form">
                            <input type="hidden" id="card-id">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="card-bank-select" class="form-label">Banco</label>
                                        <select class="form-select" id="card-bank-select" required>
                                            <option value="">Selecione um banco</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="card-name" class="form-label">Nome do Cartão</label>
                                        <input type="text" class="form-control" id="card-name" required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="card-type" class="form-label">Tipo</label>
                                        <select class="form-select" id="card-type" required>
                                            <option value="credit">Crédito</option>
                                            <option value="debit">Débito</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="card-limit" class="form-label">Limite</label>
                                        <input type="number" step="0.01" class="form-control" id="card-limit">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="card-due-day" class="form-label">Vencimento</label>
                                        <input type="number" min="1" max="31" class="form-control" id="card-due-day">
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success me-2">Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideCardForm()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div id="cards-list">
                        <!-- Conteúdo carregado via JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Transações -->
        <div id="transactions-section" class="section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Compras</h2>
                <button class="btn btn-primary" onclick="showTransactionForm()">Nova Compra</button>
            </div>
            
            <!-- Filtros -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6>Filtros</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="filter-date-from" class="form-label">Data Inicial</label>
                            <input type="date" class="form-control" id="filter-date-from">
                        </div>
                        <div class="col-md-3">
                            <label for="filter-date-to" class="form-label">Data Final</label>
                            <input type="date" class="form-control" id="filter-date-to">
                        </div>
                        <div class="col-md-2">
                            <label for="filter-bank" class="form-label">Banco</label>
                            <select class="form-select" id="filter-bank">
                                <option value="">Todos os bancos</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="filter-status" class="form-label">Status</label>
                            <select class="form-select" id="filter-status">
                                <option value="">Todos</option>
                                <option value="paid">Pago</option>
                                <option value="pending">Pendente</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end gap-2">
                            <button class="btn btn-primary" onclick="applyFilters()">Aplicar Filtros</button>
                            <button class="btn btn-outline-secondary" onclick="clearFilters()">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ações em Lote -->
            <div class="card mb-4" id="bulk-actions" style="display: none;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <span id="selected-count">0 transações selecionadas</span>
                        <div>
                            <button class="btn btn-success btn-sm" onclick="bulkUpdateStatus(true)">Marcar como Pagas</button>
                            <button class="btn btn-warning btn-sm" onclick="bulkUpdateStatus(false)">Marcar como Pendentes</button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="clearSelection()">Limpar Seleção</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ações Rápidas -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">Ações Rápidas</span>
                        <div>
                            <button class="btn btn-info btn-sm" onclick="markPreviousAsPaid()" title="Marca todas as compras de datas anteriores ao dia atual como pagas">
                                Pagar Compras Anteriores
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="transaction-form-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 id="transaction-form-title">Nova Compra</h5>
                    </div>
                    <div class="card-body">
                        <form id="transaction-form">
                            <input type="hidden" id="transaction-id">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="card-select" class="form-label">Cartão</label>
                                        <select class="form-select" id="card-select" required onchange="toggleInstallments()">
                                            <option value="">Selecione um cartão</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="amount" class="form-label">Valor Total</label>
                                        <input type="number" step="0.01" class="form-control" id="amount" required>
                                    </div>
                                </div>
                                <div class="col-md-2" id="installments-field" style="display: none;">
                                    <div class="mb-3">
                                        <label for="installments" class="form-label">Parcelas</label>
                                        <input type="number" min="1" max="60" class="form-control" id="installments" value="1" placeholder="1">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="category-select" class="form-label">Categoria</label>
                                        <select class="form-select" id="category-select">
                                            <option value="">Sem categoria</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="description" class="form-label">Descrição</label>
                                        <input type="text" class="form-control" id="description" required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="mb-3">
                                        <label for="transaction-date" class="form-label">Data da Compra</label>
                                        <input type="date" class="form-control" id="transaction-date" required>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success me-2">Salvar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideTransactionForm()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                                    </th>
                                    <th>Data Compra</th>
                                    <th>Data Fatura</th>
                                    <th>Banco</th>
                                    <th>Cartão</th>
                                    <th>Categoria</th>
                                    <th>Descrição</th>
                                    <th>Valor</th>
                                    <th>Parcela</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-list">
                                <!-- Conteúdo carregado via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Depósitos -->
        <div id="transfers-section" class="section" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Depósitos</h2>
                <button class="btn btn-primary" onclick="showTransferForm()">Novo Depósito</button>
            </div>
            
            <!-- Filtros -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6>Filtros</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label for="deposit-filter-date-from" class="form-label">Data Inicial</label>
                            <input type="date" class="form-control" id="deposit-filter-date-from">
                        </div>
                        <div class="col-md-3">
                            <label for="deposit-filter-date-to" class="form-label">Data Final</label>
                            <input type="date" class="form-control" id="deposit-filter-date-to">
                        </div>
                        <div class="col-md-3">
                            <label for="deposit-filter-bank" class="form-label">Banco</label>
                            <select class="form-select" id="deposit-filter-bank">
                                <option value="">Todos os bancos</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end gap-2">
                            <button class="btn btn-primary" onclick="applyDepositFilters()">Aplicar</button>
                            <button class="btn btn-outline-secondary" onclick="clearDepositFilters()">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="transfer-form-section" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>Novo Depósito</h5>
                    </div>
                    <div class="card-body">
                        <form id="transfer-form">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="deposit-bank" class="form-label">Banco</label>
                                        <select class="form-select" id="deposit-bank" required>
                                            <option value="">Selecione o banco</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="deposit-amount" class="form-label">Valor</label>
                                        <input type="number" step="0.01" class="form-control" id="deposit-amount" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="deposit-date" class="form-label">Data</label>
                                        <input type="date" class="form-control" id="deposit-date" required>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label for="deposit-description" class="form-label">Descrição</label>
                                        <input type="text" class="form-control" id="deposit-description" required>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success me-2">Depositar</button>
                            <button type="button" class="btn btn-secondary" onclick="hideTransferForm()">Cancelar</button>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5>Histórico de Depósitos</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Banco</th>
                                    <th>Descrição</th>
                                    <th>Valor</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="transfers-list">
                                <!-- Conteúdo carregado via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edição -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalTitle">Editar Compra</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="edit-form">
                        <input type="hidden" id="edit-transaction-id">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="edit-card-select" class="form-label">Cartão</label>
                                    <select class="form-select" id="edit-card-select" required onchange="toggleEditInstallments()">
                                        <option value="">Selecione um cartão</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="edit-amount" class="form-label">Valor Total</label>
                                    <input type="number" step="0.01" class="form-control" id="edit-amount" required>
                                </div>
                            </div>
                            <div class="col-md-2" id="edit-installments-field" style="display: none;">
                                <div class="mb-3">
                                    <label for="edit-installments" class="form-label">Parcelas</label>
                                    <input type="number" min="1" max="60" class="form-control" id="edit-installments" value="1">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="edit-category-select" class="form-label">Categoria</label>
                                    <select class="form-select" id="edit-category-select">
                                        <option value="">Sem categoria</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="mb-3">
                                    <label for="edit-description" class="form-label">Descrição</label>
                                    <input type="text" class="form-control" id="edit-description" required>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="mb-3">
                                    <label for="edit-transaction-date" class="form-label">Data da Compra</label>
                                    <input type="date" class="form-control" id="edit-transaction-date" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveEdit()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Funções JavaScript movidas para app.js -->
    <script>
        // Verificar autenticação ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
            
            // Verificar se o token é válido
            fetch('/api/auth/me', {
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            })
            .then(response => {
                if (!response.ok) {
                    localStorage.removeItem('token');
                    window.location.href = '/login';
                    return;
                }
                return response.json();
            })
            .then(user => {
                if (user) {
                    document.getElementById('user-info').textContent = `Olá, ${user.full_name}`;
                    // Carregar dashboard após autenticação
                    setTimeout(() => {
                        if (typeof showSection === 'function') {
                            showSection('dashboard');
                        }
                    }, 500);
                }
            })
            .catch(() => {
                localStorage.removeItem('token');
                window.location.href = '/login';
            });
        });
        
        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/login';
        }
        
        // A autenticação agora é feita automaticamente pelo app_auth.js
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/app_auth.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>